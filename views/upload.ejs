<% layout('layout/boilerplate.ejs') %>

<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h3 class="text-center">Upload Material</h3>
        </div>
        <div class="card-body">
          <form id="uploadForm" action="/api/materials/upload" method="POST" enctype="multipart/form-data">
            <div class="mb-3">
              <label for="title" class="form-label">Title</label>
              <input type="text" class="form-control" id="title" name="title" required>
            </div>
            <div class="mb-3">
              <label for="file" class="form-label">File (PDF, DOC, DOCX, TXT)</label>
              <input type="file" class="form-control" id="file" name="file" accept=".pdf,.doc,.docx,.txt" required>
            </div>
            <button type="submit" class="btn btn-primary w-100" id="submitBtn">Upload</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.getElementById('uploadForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const submitBtn = document.getElementById('submitBtn')
  
  submitBtn.disabled = true;
  submitBtn.textContent = 'Uploading...';

  try {
    const response = await fetch('/api/materials/upload', {
      method: 'POST',
      body: formData
    });
    const result = await response.json();
    console.log('Upload response:', response.status, result);
    if (result.success) {
      alert('Upload successful!');
      e.target.reset();
      // Redirect to success page
      window.location.href = result.redirectUrl;
    } else {
      alert('Error: ' + result.error);
      console.error('Upload error:', result.error);
    }
  } catch (error) {
    alert('Upload failed: ' + error.message);
    console.error('Upload failed:', error);
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = 'Upload';
  }
});
</script>
