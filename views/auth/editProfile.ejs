<% layout('layout/boilerplate.ejs') %>

<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">
      <!-- Edit Profile Header -->
      <div class="edit-profile-header text-center mb-5">
        <div style="background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%); border-radius: 25px; padding: 50px 30px; color: white; box-shadow: 0 20px 40px rgba(108, 92, 231, 0.3); position: relative; overflow: hidden;">
          <div style="position: absolute; top: -20px; right: -20px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
          <div style="position: absolute; bottom: -30px; left: -30px; width: 150px; height: 150px; background: rgba(255,255,255,0.05); border-radius: 50%;"></div>
          <div style="font-size: 4rem; margin-bottom: 20px; opacity: 0.9;">
            <i class="fas fa-user-edit"></i>
          </div>
          <h1 style="font-weight: 700; font-size: 2.5rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); margin-bottom: 10px;">
            Edit Your Profile
          </h1>
          <p style="opacity: 0.9; margin-bottom: 0; font-size: 1.1rem;">
            Update your personal information and preferences
          </p>
        </div>
      </div>

      <!-- Edit Profile Form -->
      <div class="edit-profile-card" style="background: linear-gradient(145deg, #ffffff 0%, #f8f9ff 100%); border-radius: 20px; box-shadow: 0 10px 30px rgba(108, 92, 231, 0.15); overflow: hidden; border: 1px solid rgba(108, 92, 231, 0.1);">
        <div class="edit-profile-card-body" style="padding: 40px;">
          <form action="/edit-profile" method="POST" class="needs-validation" novalidate>

            <!-- Password Confirmation -->
            <div class="mb-4">
              <label for="password" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1.1rem; margin-bottom: 12px;">
                <i class="fas fa-lock me-2" style="color: #fd79a8;"></i>Confirm Your Password
              </label>
              <div class="input-group">
                <input type="password" class="form-control form-control-lg" id="password" name="password" required
                       style="border-radius: 15px 0 0 15px; border: 2px solid #e9ecef; border-right: none; padding: 14px 20px; font-size: 1rem; transition: all 0.3s ease; background: rgba(253, 121, 168, 0.02);"
                       placeholder="Enter your current password">
                <button class="btn btn-outline-secondary" type="button" id="togglePassword"
                        style="border-radius: 0 15px 15px 0; border: 2px solid #e9ecef; border-left: none; background: rgba(253, 121, 168, 0.02);">
                  <i class="fas fa-eye" id="passwordIcon"></i>
                </button>
              </div>
              <div class="invalid-feedback" style="margin-top: 8px;">
                Please enter your current password to confirm changes.
              </div>
              <small style="color: #6c757d; font-size: 0.9rem; margin-top: 8px; display: block;">
                <i class="fas fa-info-circle me-1"></i>For security, please confirm your password before making changes.
              </small>
            </div>

            <!-- First Name -->
            <div class="mb-4">
              <label for="firstName" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1.1rem; margin-bottom: 12px;">
                <i class="fas fa-user me-2" style="color: #6c5ce7;"></i>First Name
              </label>
              <input type="text" class="form-control form-control-lg" id="firstName" name="firstName" required
                     style="border-radius: 15px; border: 2px solid #e9ecef; padding: 14px 20px; font-size: 1rem; transition: all 0.3s ease; background: rgba(108, 92, 231, 0.02);"
                     value="<%= user.firstName %>">
              <div class="invalid-feedback" style="margin-top: 8px;">
                Please enter your first name.
              </div>
            </div>

            <!-- Last Name -->
            <div class="mb-4">
              <label for="lastName" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1.1rem; margin-bottom: 12px;">
                <i class="fas fa-user me-2" style="color: #6c5ce7;"></i>Last Name
              </label>
              <input type="text" class="form-control form-control-lg" id="lastName" name="lastName" required
                     style="border-radius: 15px; border: 2px solid #e9ecef; padding: 14px 20px; font-size: 1rem; transition: all 0.3s ease; background: rgba(108, 92, 231, 0.02);"
                     value="<%= user.lastName %>">
              <div class="invalid-feedback" style="margin-top: 8px;">
                Please enter your last name.
              </div>
            </div>

            <!-- Email -->
            <div class="mb-4">
              <label for="email" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1.1rem; margin-bottom: 12px;">
                <i class="fas fa-envelope me-2" style="color: #fd79a8;"></i>Email Address
              </label>
              <input type="email" class="form-control form-control-lg" id="email" name="email" required
                     style="border-radius: 15px; border: 2px solid #e9ecef; padding: 14px 20px; font-size: 1rem; transition: all 0.3s ease; background: rgba(253, 121, 168, 0.02);"
                     value="<%= user.email %>">
              <div class="invalid-feedback" style="margin-top: 8px;">
                Please enter a valid email address.
              </div>
            </div>

            <!-- Bio -->
            <div class="mb-4">
              <label for="bio" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1.1rem; margin-bottom: 12px;">
                <i class="fas fa-info-circle me-2" style="color: #fd79a8;"></i>About You
              </label>
              <div style="position: relative;">
                <textarea class="form-control form-control-lg" id="bio" name="bio" rows="4"
                         style="border-radius: 15px; border: 2px solid #e9ecef; padding: 16px 20px; font-size: 1rem; transition: all 0.3s ease; resize: vertical; background: rgba(253, 121, 168, 0.02);"
                         placeholder="Share a bit about yourself, your interests, or your goals..."><%= user.bio || '' %></textarea>
                <small style="color: #6c757d; font-size: 0.9rem; margin-top: 8px; display: block;">
                  <i class="fas fa-lightbulb me-1"></i>This helps us personalize your experience (optional)
                </small>
              </div>
            </div>

            <!-- Role Selection -->
            <div class="mb-4">
              <label for="role" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1.1rem; margin-bottom: 12px;">
                <i class="fas fa-graduation-cap me-2" style="color: #00b894;"></i>I am a
              </label>
              <select class="form-select form-select-lg" id="role" name="role" required
                      style="border-radius: 15px; border: 2px solid #e9ecef; padding: 14px 20px; font-size: 1rem; transition: all 0.3s ease; background: rgba(0, 184, 148, 0.02);">
                <option value="">Select your role</option>
                <option value="Teacher" <%= user.role === 'Teacher' ? 'selected' : '' %>>👨‍🏫 Teacher - I create and share educational content</option>
                <option value="Student" <%= user.role === 'Student' ? 'selected' : '' %>>🎓 Student - I learn and study materials</option>
              </select>
              <div class="invalid-feedback" style="margin-top: 8px;">
                Please select your role.
              </div>
            </div>

            <!-- Student Type (Conditional) -->
            <div class="mb-4" id="studentTypeDiv" style="<%= user.role === 'Student' ? 'display: block;' : 'display: none;' %>">
              <label for="studentType" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1.1rem; margin-bottom: 12px;">
                <i class="fas fa-school me-2" style="color: #00b894;"></i>Education Level
              </label>
              <select class="form-select form-select-lg" id="studentType" name="studentType"
                      style="border-radius: 15px; border: 2px solid #e9ecef; padding: 14px 20px; font-size: 1rem; transition: all 0.3s ease; background: rgba(0, 184, 148, 0.02);">
                <option value="">Select your education level</option>
                <option value="High School" <%= user.studentType === 'High School' ? 'selected' : '' %>>🏫 High School - Grades 9-12</option>
                <option value="University/College" <%= user.studentType === 'University/College' ? 'selected' : '' %>>🎓 University/College - Higher education</option>
              </select>
            </div>

            <!-- Grade (Conditional) -->
            <div class="mb-4" id="gradeDiv" style="<%= user.studentType === 'High School' ? 'display: block;' : 'display: none;' %>">
              <label for="grade" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1.1rem; margin-bottom: 12px;">
                <i class="fas fa-graduation-cap me-2" style="color: #00b894;"></i>Grade Level
              </label>
              <select class="form-select form-select-lg" id="grade" name="grade"
                      style="border-radius: 15px; border: 2px solid #e9ecef; padding: 14px 20px; font-size: 1rem; transition: all 0.3s ease; background: rgba(0, 184, 148, 0.02);">
                <option value="">Select your grade</option>
                <option value="9" <%= user.grade == 9 ? 'selected' : '' %>>9th Grade - Freshman</option>
                <option value="10" <%= user.grade == 10 ? 'selected' : '' %>>10th Grade - Sophomore</option>
                <option value="11" <%= user.grade == 11 ? 'selected' : '' %>>11th Grade - Junior</option>
                <option value="12" <%= user.grade == 12 ? 'selected' : '' %>>12th Grade - Senior</option>
              </select>
            </div>

            <!-- Action Buttons -->
            <div class="d-flex justify-content-between mt-5">
              <a href="/profile" class="btn btn-outline-secondary btn-lg" style="border-radius: 25px; font-weight: 600; padding: 14px 30px; border: 2px solid #6c757d; transition: all 0.3s ease;">
                <i class="fas fa-arrow-left me-2"></i>Cancel
              </a>
              <button type="submit" class="btn btn-primary btn-lg" style="border-radius: 25px; font-weight: 700; font-size: 1.1rem; padding: 14px 30px; box-shadow: 0 8px 25px rgba(108, 92, 231, 0.3); transition: all 0.3s ease; background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%); border: none;">
                <i class="fas fa-save me-2"></i>Save Changes
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Role-based field visibility
document.getElementById('role').addEventListener('change', function() {
  const studentTypeDiv = document.getElementById('studentTypeDiv');
  const gradeDiv = document.getElementById('gradeDiv');
  const studentType = document.getElementById('studentType');

  if (this.value === 'Student') {
    studentTypeDiv.style.display = 'block';
    studentType.required = true;
  } else {
    studentTypeDiv.style.display = 'none';
    gradeDiv.style.display = 'none';
    studentType.required = false;
    document.getElementById('grade').required = false;
  }
});

document.getElementById('studentType').addEventListener('change', function() {
  const gradeDiv = document.getElementById('gradeDiv');
  const grade = document.getElementById('grade');

  if (this.value === 'High School') {
    gradeDiv.style.display = 'block';
    grade.required = true;
  } else {
    gradeDiv.style.display = 'none';
    grade.required = false;
  }
});

// Password visibility toggle
document.getElementById('togglePassword').addEventListener('click', function() {
  const input = document.getElementById('password');
  const icon = document.getElementById('passwordIcon');
  togglePasswordVisibility(input, icon);
});

function togglePasswordVisibility(input, icon) {
  if (input.type === 'password') {
    input.type = 'text';
    icon.classList.remove('fa-eye');
    icon.classList.add('fa-eye-slash');
  } else {
    input.type = 'password';
    icon.classList.remove('fa-eye-slash');
    icon.classList.add('fa-eye');
  }
}

// Form validation and enhancement
document.addEventListener('DOMContentLoaded', function() {
  const form = document.querySelector('.needs-validation');

  form.addEventListener('submit', function(event) {
    if (!form.checkValidity()) {
      event.preventDefault();
      event.stopPropagation();
    }
    form.classList.add('was-validated');
  });

  // Enhanced focus effects
  const inputs = document.querySelectorAll('input, select, textarea');
  inputs.forEach(input => {
    input.addEventListener('focus', function() {
      this.style.borderColor = '#6c5ce7';
      this.style.boxShadow = '0 0 0 0.2rem rgba(108, 92, 231, 0.25)';
      this.style.background = 'rgba(108, 92, 231, 0.05)';
    });

    input.addEventListener('blur', function() {
      this.style.borderColor = '#e9ecef';
      this.style.boxShadow = 'none';
      this.style.background = 'rgba(108, 92, 231, 0.02)';
    });
  });
});
</script>

<style>
.edit-profile-card input:focus, .edit-profile-card select:focus, .edit-profile-card textarea:focus {
  border-color: #6c5ce7 !important;
  box-shadow: 0 0 0 0.2rem rgba(108, 92, 231, 0.25) !important;
  background: rgba(108, 92, 231, 0.05) !important;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 30px rgba(108, 92, 231, 0.4) !important;
}

.form-select option {
  padding: 8px;
}

.input-group .btn {
  border-color: #e9ecef !important;
}

.input-group .btn:hover {
  background-color: rgba(253, 121, 168, 0.1) !important;
  border-color: #fd79a8 !important;
}
</style>
