<% layout('layout/boilerplate.ejs') %>

<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-lg-6 col-md-8">
      <!-- Register Header -->
      <div class="register-header text-center mb-4">
        <div style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border-radius: 20px; padding: 40px 30px; color: white; box-shadow: 0 15px 35px rgba(40, 167, 69, 0.3);">
          <div style="font-size: 3rem; margin-bottom: 15px; opacity: 0.9;">
            <i class="fas fa-user-plus"></i>
          </div>
          <h2 style="font-weight: 700; margin-bottom: 10px; text-shadow: 1px 1px 2px rgba(0,0,0,0.3);">
            Join EduVision AI
          </h2>
          <p style="opacity: 0.9; margin-bottom: 0; font-size: 1rem;">
            Create your account and start transforming your study materials with AI
          </p>
        </div>
      </div>

      <!-- Register Form -->
      <div class="register-card" style="background: linear-gradient(145deg, #ffffff 0%, #f8fff8 100%); border-radius: 20px; box-shadow: 0 10px 30px rgba(40, 167, 69, 0.15); overflow: hidden; border: 1px solid rgba(40, 167, 69, 0.1);">
        <div class="register-card-body" style="padding: 40px;">
          <form action="/register" method="POST" class="needs-validation" novalidate>
            <!-- Name Fields Row -->
            <div class="row mb-4">
              <div class="col-md-6">
                <label for="firstName" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1rem; margin-bottom: 8px;">
                  <i class="fas fa-user me-2" style="color: #28a745;"></i>First Name
                </label>
                <input type="text" class="form-control form-control-lg" id="firstName" name="firstName" required
                       style="border-radius: 12px; border: 2px solid #e9ecef; padding: 12px 16px; font-size: 1rem; transition: all 0.3s ease;"
                       placeholder="Enter first name">
                <div class="invalid-feedback">
                  Please provide your first name.
                </div>
              </div>
              <div class="col-md-6">
                <label for="lastName" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1rem; margin-bottom: 8px;">
                  <i class="fas fa-user me-2" style="color: #28a745;"></i>Last Name
                </label>
                <input type="text" class="form-control form-control-lg" id="lastName" name="lastName" required
                       style="border-radius: 12px; border: 2px solid #e9ecef; padding: 12px 16px; font-size: 1rem; transition: all 0.3s ease;"
                       placeholder="Enter last name">
                <div class="invalid-feedback">
                  Please provide your last name.
                </div>
              </div>
            </div>

            <!-- Username and Email Row -->
            <div class="row mb-4">
              <div class="col-md-6">
                <label for="username" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1rem; margin-bottom: 8px;">
                  <i class="fas fa-at me-2" style="color: #28a745;"></i>Username
                </label>
                <input type="text" class="form-control form-control-lg" id="username" name="username" required
                       style="border-radius: 12px; border: 2px solid #e9ecef; padding: 12px 16px; font-size: 1rem; transition: all 0.3s ease;"
                       placeholder="Choose a username">
                <div class="invalid-feedback">
                  Please choose a username.
                </div>
              </div>
              <div class="col-md-6">
                <label for="email" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1rem; margin-bottom: 8px;">
                  <i class="fas fa-envelope me-2" style="color: #28a745;"></i>Email Address
                </label>
                <input type="email" class="form-control form-control-lg" id="email" name="email" required
                       style="border-radius: 12px; border: 2px solid #e9ecef; padding: 12px 16px; font-size: 1rem; transition: all 0.3s ease;"
                       placeholder="Enter email address">
                <div class="invalid-feedback">
                  Please provide a valid email address.
                </div>
              </div>
            </div>

            <!-- Bio Field -->
            <div class="mb-4">
              <label for="bio" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1rem; margin-bottom: 8px;">
                <i class="fas fa-info-circle me-2" style="color: #28a745;"></i>Bio (Optional)
              </label>
              <textarea class="form-control form-control-lg" id="bio" name="bio" rows="3"
                        style="border-radius: 12px; border: 2px solid #e9ecef; padding: 12px 16px; font-size: 1rem; transition: all 0.3s ease; resize: vertical;"
                        placeholder="Tell us a bit about yourself..."></textarea>
            </div>

            <!-- Role Selection -->
            <div class="mb-4">
              <label for="role" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1rem; margin-bottom: 8px;">
                <i class="fas fa-graduation-cap me-2" style="color: #28a745;"></i>I am a
              </label>
              <select class="form-select form-select-lg" id="role" name="role" required
                      style="border-radius: 12px; border: 2px solid #e9ecef; padding: 12px 16px; font-size: 1rem; transition: all 0.3s ease;">
                <option value="">Select your role</option>
                <option value="Teacher">üë®‚Äçüè´ Teacher</option>
                <option value="Student">üéì Student</option>
              </select>
              <div class="invalid-feedback">
                Please select your role.
              </div>
            </div>

            <!-- Student Type (Conditional) -->
            <div class="mb-4" id="studentTypeDiv" style="display: none;">
              <label for="studentType" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1rem; margin-bottom: 8px;">
                <i class="fas fa-school me-2" style="color: #28a745;"></i>Education Level
              </label>
              <select class="form-select form-select-lg" id="studentType" name="studentType"
                      style="border-radius: 12px; border: 2px solid #e9ecef; padding: 12px 16px; font-size: 1rem; transition: all 0.3s ease;">
                <option value="">Select your education level</option>
                <option value="High School">üè´ High School</option>
                <option value="University/College">üéì University/College</option>
              </select>
            </div>

            <!-- Grade (Conditional) -->
            <div class="mb-4" id="gradeDiv" style="display: none;">
              <label for="grade" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1rem; margin-bottom: 8px;">
                <i class="fas fa-graduation-cap me-2" style="color: #28a745;"></i>Grade Level
              </label>
              <select class="form-select form-select-lg" id="grade" name="grade"
                      style="border-radius: 12px; border: 2px solid #e9ecef; padding: 12px 16px; font-size: 1rem; transition: all 0.3s ease;">
                <option value="">Select your grade</option>
                <option value="9">9th Grade</option>
                <option value="10">10th Grade</option>
                <option value="11">11th Grade</option>
                <option value="12">12th Grade</option>
              </select>
            </div>

            <!-- Timezone -->
            <div class="mb-4">
              <label for="timezone" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1rem; margin-bottom: 8px;">
                <i class="fas fa-globe me-2" style="color: #28a745;"></i>Timezone
              </label>
              <input type="text" class="form-control form-control-lg" id="timezone" name="timezone" list="timezoneList"
                     style="border-radius: 12px; border: 2px solid #e9ecef; padding: 12px 16px; font-size: 1rem; transition: all 0.3s ease;"
                     placeholder="Start typing to search timezones...">
              <datalist id="timezoneList">
                <option value="UTC-12:00 - Baker Island Time">
                <option value="UTC-11:00 - Niue Time">
                <option value="UTC-10:00 - Hawaii-Aleutian Standard Time">
                <option value="UTC-09:00 - Alaska Standard Time">
                <option value="UTC-08:00 - Pacific Standard Time">
                <option value="UTC-07:00 - Mountain Standard Time">
                <option value="UTC-06:00 - Central Standard Time">
                <option value="UTC-05:00 - Eastern Standard Time">
                <option value="UTC-04:00 - Atlantic Standard Time">
                <option value="UTC-03:00 - Argentina Time">
                <option value="UTC-02:00 - South Georgia Time">
                <option value="UTC-01:00 - Azores Time">
                <option value="UTC+00:00 - Greenwich Mean Time">
                <option value="UTC+01:00 - Central European Time">
                <option value="UTC+02:00 - Eastern European Time">
                <option value="UTC+03:00 - Moscow Time">
                <option value="UTC+04:00 - Gulf Standard Time">
                <option value="UTC+05:00 - Pakistan Standard Time">
                <option value="UTC+06:00 - Bangladesh Standard Time">
                <option value="UTC+07:00 - Indochina Time">
                <option value="UTC+08:00 - China Standard Time">
                <option value="UTC+09:00 - Japan Standard Time">
                <option value="UTC+10:00 - Australian Eastern Standard Time">
                <option value="UTC+11:00 - Solomon Islands Time">
                <option value="UTC+12:00 - Fiji Time">
              </datalist>
              <small style="color: #6c757d; font-size: 0.9rem; margin-top: 8px; display: block;">
                <i class="fas fa-clock me-1"></i>Start typing to search and select your local timezone (optional)
              </small>
            </div>

            <!-- Study Preferences -->
            <div class="mb-4">
              <label class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1rem; margin-bottom: 8px;">
                <i class="fas fa-book me-2" style="color: #28a745;"></i>Study Preferences
              </label>

              <!-- Subjects -->
              <div class="mb-3">
                <label style="font-weight: 500; color: #2c3e50; font-size: 0.95rem; margin-bottom: 6px;">
                  <i class="fas fa-list me-2" style="color: #28a745;"></i>Favorite Subjects
                </label>
                <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                  <% const subjects = ['Mathematics', 'Science', 'English', 'History', 'Geography', 'Art', 'Music', 'Physical Education', 'Computer Science', 'Languages']; %>
                  <% subjects.forEach(subject => { %>
                    <div class="form-check" style="flex: 1 1 180px;">
                      <input class="form-check-input" type="checkbox" name="studyPreferences[subject]" value="<%= subject %>" id="register-subject-<%= subject.replace(/\s+/g, '-').toLowerCase() %>"
                             style="transform: scale(1.1); margin-right: 6px;">
                      <label class="form-check-label" for="register-subject-<%= subject.replace(/\s+/g, '-').toLowerCase() %>" style="font-size: 0.9rem; color: #495057;">
                        <%= subject %>
                      </label>
                    </div>
                  <% }); %>
                </div>
                <small style="color: #6c757d; font-size: 0.85rem; margin-top: 6px; display: block;">
                  <i class="fas fa-info-circle me-1"></i>Select subjects you're interested in (optional)
                </small>
              </div>

              <!-- Availability -->
              <div class="mb-3">
                <label style="font-weight: 500; color: #2c3e50; font-size: 0.95rem; margin-bottom: 6px;">
                  <i class="fas fa-calendar-alt me-2" style="color: #28a745;"></i>Study Availability
                </label>
                <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                  <% const availabilities = ['Weekdays Morning', 'Weekdays Afternoon', 'Weekdays Evening', 'Weekends Morning', 'Weekends Afternoon', 'Weekends Evening', 'Flexible']; %>
                  <% availabilities.forEach(availability => { %>
                    <div class="form-check" style="flex: 1 1 180px;">
                      <input class="form-check-input" type="checkbox" name="studyPreferences[availability]" value="<%= availability %>" id="register-availability-<%= availability.replace(/\s+/g, '-').toLowerCase() %>"
                             style="transform: scale(1.1); margin-right: 6px;">
                      <label class="form-check-label" for="register-availability-<%= availability.replace(/\s+/g, '-').toLowerCase() %>" style="font-size: 0.9rem; color: #495057;">
                        <%= availability %>
                      </label>
                    </div>
                  <% }); %>
                </div>
                <small style="color: #6c757d; font-size: 0.85rem; margin-top: 6px; display: block;">
                  <i class="fas fa-clock me-1"></i>Select your preferred study times (optional)
                </small>
              </div>

              <!-- Goals -->
              <div class="mb-3">
                <label for="studyGoals" style="font-weight: 500; color: #2c3e50; font-size: 0.95rem; margin-bottom: 6px;">
                  <i class="fas fa-bullseye me-2" style="color: #28a745;"></i>Study Goals
                </label>
                <textarea class="form-control form-control-lg" id="studyGoals" name="studyPreferences[goals]" rows="2"
                         style="border-radius: 12px; border: 2px solid #e9ecef; padding: 10px 14px; font-size: 0.95rem; transition: all 0.3s ease; background: rgba(40, 167, 69, 0.02); resize: vertical;"
                         placeholder="Describe your study goals..."></textarea>
                <small style="color: #6c757d; font-size: 0.85rem; margin-top: 6px; display: block;">
                  <i class="fas fa-lightbulb me-1"></i>Share your learning objectives (optional)
                </small>
              </div>
            </div>

            <!-- Password Fields Row -->
            <div class="row mb-4">
              <div class="col-md-6">
                <label for="password" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1rem; margin-bottom: 8px;">
                  <i class="fas fa-lock me-2" style="color: #28a745;"></i>Password
                </label>
                <input type="password" class="form-control form-control-lg" id="password" name="password" required
                       style="border-radius: 12px; border: 2px solid #e9ecef; padding: 12px 16px; font-size: 1rem; transition: all 0.3s ease;"
                       placeholder="Create password">
                <div class="invalid-feedback">
                  Please create a password.
                </div>
              </div>
              <div class="col-md-6">
                <label for="confirmPassword" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1rem; margin-bottom: 8px;">
                  <i class="fas fa-lock me-2" style="color: #28a745;"></i>Confirm Password
                </label>
                <input type="password" class="form-control form-control-lg" id="confirmPassword" name="confirmPassword" required
                       style="border-radius: 12px; border: 2px solid #e9ecef; padding: 12px 16px; font-size: 1rem; transition: all 0.3s ease;"
                       placeholder="Confirm password">
                <div class="invalid-feedback">
                  Please confirm your password.
                </div>
              </div>
            </div>

            <!-- Register Button -->
            <div class="d-grid mb-4">
              <button type="submit" class="btn btn-success btn-lg" style="border-radius: 25px; font-weight: 700; font-size: 1.1rem; padding: 14px; box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3); transition: all 0.3s ease;">
                <i class="fas fa-user-plus me-2"></i>Create Account
              </button>
            </div>
          </form>

          <!-- Divider -->
          <div class="divider mb-4" style="position: relative; text-align: center;">
            <hr style="border: none; height: 1px; background: linear-gradient(90deg, transparent, #dee2e6, transparent);">
            <span style="position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: linear-gradient(145deg, #ffffff 0%, #f8fff8 100%); padding: 0 15px; color: #6c757d; font-weight: 600; font-size: 0.9rem;">or sign up with</span>
          </div>

          <!-- Google Register -->
          <div class="text-center">
            <a href="/auth/google" class="btn btn-outline-danger btn-lg w-100" style="border-radius: 25px; font-weight: 600; padding: 14px; border: 2px solid #dc3545; transition: all 0.3s ease;">
              <i class="fab fa-google me-2"></i>Continue with Google
            </a>
          </div>
        </div>
      </div>

      <!-- Sign In Link -->
      <div class="text-center mt-4">
        <p style="color: #6c757d; margin-bottom: 10px;">
          Already have an account?
          <a href="/login" class="text-decoration-none" style="color: #28a745; font-weight: 700;">
            Sign in here
          </a>
        </p>
      </div>
    </div>
  </div>
</div>

<script>
// Role-based field visibility
document.getElementById('role').addEventListener('change', function() {
  const studentTypeDiv = document.getElementById('studentTypeDiv');
  const gradeDiv = document.getElementById('gradeDiv');
  const studentType = document.getElementById('studentType');

  if (this.value === 'Student') {
    studentTypeDiv.style.display = 'block';
    studentType.required = true;
  } else {
    studentTypeDiv.style.display = 'none';
    gradeDiv.style.display = 'none';
    studentType.required = false;
    document.getElementById('grade').required = false;
  }
});

document.getElementById('studentType').addEventListener('change', function() {
  const gradeDiv = document.getElementById('gradeDiv');
  const grade = document.getElementById('grade');

  if (this.value === 'High School') {
    gradeDiv.style.display = 'block';
    grade.required = true;
  } else {
    gradeDiv.style.display = 'none';
    grade.required = false;
  }
});
</script>

<style>
.register-card input:focus, .register-card select:focus, .register-card textarea:focus {
  border-color: #28a745 !important;
  box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25) !important;
}

.btn:hover {
  transform: translateY(-2px);
}
</style>
