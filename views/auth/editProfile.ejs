<% layout('layout/boilerplate.ejs') %>
<% title = 'Edit Profile' %>

<style>
  /* Custom Checkbox Styling */
  .custom-checkbox {
    position: relative;
    display: inline-block;
    cursor: pointer;
    padding-left: 32px;
    line-height: 1.3;
    font-size: 0.95rem;
    color: #495057;
    user-select: none;
  }

  .custom-checkbox input {
    position: absolute;
    opacity: 0;
    cursor: pointer;
  }

  .custom-checkbox .checkmark {
    position: absolute;
    top: 0;
    left: 0;
    height: 22px;
    width: 22px;
    border-radius: 6px;
    background-color: #e9ecef;
    transition: all 0.25s ease;
    border: 2px solid #dcdde1;
  }

  .custom-checkbox:hover .checkmark {
    border-color: #6c5ce7;
    transform: scale(1.05);
  }

  .custom-checkbox input:checked ~ .checkmark {
    background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
    border-color: transparent;
    transform: scale(1.1);
  }

  .custom-checkbox .checkmark:after {
    content: "";
    position: absolute;
    display: none;
  }

  .custom-checkbox input:checked ~ .checkmark:after {
    display: block;
  }

  .custom-checkbox .checkmark:after {
    left: 7px;
    top: 3px;
    width: 5px;
    height: 10px;
    border: solid white;
    border-width: 0 3px 3px 0;
    transform: rotate(45deg);
  }
</style>

<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">

      <div class="edit-profile-header text-center mb-5">
        <div style="background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%); border-radius: 25px; padding: 50px 30px; color: white; box-shadow: 0 20px 40px rgba(108, 92, 231, 0.3); position: relative; overflow: hidden;">
          <div style="position: absolute; top: -20px; right: -20px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
          <div style="position: absolute; bottom: -30px; left: -30px; width: 150px; height: 150px; background: rgba(255,255,255,0.05); border-radius: 50%;"></div>
          <div style="font-size: 4rem; margin-bottom: 20px; opacity: 0.9;">
            <i class="fas fa-user-edit"></i>
          </div>
          <h1 style="font-weight: 700; font-size: 2.5rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); margin-bottom: 10px;">
            Edit Your Profile
          </h1>
          <p style="opacity: 0.9; margin-bottom: 0; font-size: 1.1rem;">
            Update your personal information and preferences
          </p>
        </div>
      </div>

      <div class="edit-profile-card" style="background: linear-gradient(145deg, #ffffff 0%, #f8f9ff 100%); border-radius: 20px; box-shadow: 0 10px 30px rgba(108, 92, 231, 0.15); overflow: hidden; border: 1px solid rgba(108, 92, 231, 0.1);">
        <div class="edit-profile-card-body" style="padding: 40px;">

          <form action="/edit-profile" method="POST" class="needs-validation" novalidate>

            <!-- Password Confirmation -->
            <div class="mb-4">
              <label class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1.1rem; margin-bottom: 12px;">
                <i class="fas fa-lock me-2" style="color: #fd79a8;"></i>Confirm Your Password
              </label>
              <input type="password" class="form-control form-control-lg" id="password" name="password" required>
              <div class="invalid-feedback">
                Please enter your password.
              </div>
            </div>

            <!-- All your other fields are unchanged up until Study Preferences -->

            <!-- Study Preferences -->
            <div class="mb-4">
              <label class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1.1rem; margin-bottom: 12px;">
                <i class="fas fa-book me-2" style="color: #00b894;"></i>Study Preferences
              </label>

              <!-- Subjects -->
              <div class="mb-3">
                <label style="font-weight: 500; color: #2c3e50; font-size: 1rem; margin-bottom: 8px;">
                  <i class="fas fa-list me-2" style="color: #00b894;"></i>Favorite Subjects
                </label>
                <div style="display: flex; flex-wrap: wrap; gap: 10px;">

                  <% const subjects = ['Mathematics', 'Science', 'English', 'History', 'Geography', 'Art', 'Music', 'Physical Education', 'Computer Science', 'Languages']; %>
                  <% subjects.forEach(subject => { %>

                    <label class="custom-checkbox" style="flex: 1 1 200px;">
                      <input type="checkbox" name="studyPreferences[subjects]" value="<%= subject %>"
                       <%= user.studyPreferences?.subjects?.includes(subject) ? 'checked' : '' %> >
                      <span class="checkmark"></span>
                      <%= subject %>
                    </label>

                  <% }) %>

                </div>
              </div>

              <!-- Availability -->
              <div class="mb-3">
                <label style="font-weight: 500; color: #2c3e50; font-size: 1rem; margin-bottom: 8px;">
                  <i class="fas fa-calendar-alt me-2" style="color: #00b894;"></i>Study Availability
                </label>

                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                  <% const availabilities = ['Weekdays Morning', 'Weekdays Afternoon', 'Weekdays Evening', 'Weekends Morning', 'Weekends Afternoon', 'Weekends Evening', 'Flexible']; %>
                  <% availabilities.forEach(a => { %>

                    <label class="custom-checkbox" style="flex: 1 1 200px;">
                      <input type="checkbox" name="studyPreferences[availability]" value="<%= a %>"
                       <%= user.studyPreferences?.availability?.includes(a) ? 'checked' : '' %> >
                      <span class="checkmark"></span>
                      <%= a %>
                    </label>

                  <% }) %>
                </div>
              </div>

              <!-- Goals -->
              <div class="mb-3">
                <label for="studyGoals" style="font-weight: 500; color: #2c3e50; font-size: 1rem; margin-bottom: 8px;">
                  <i class="fas fa-bullseye me-2" style="color: #00b894;"></i>Study Goals
                </label>
                <textarea class="form-control form-control-lg" id="studyGoals" name="studyPreferences[goals]" rows="3"><%= user.studyPreferences?.goals || '' %></textarea>
              </div>
            </div>

            <!-- Submit Buttons -->
            <div class="d-flex justify-content-between mt-5">
              <a href="/profile" class="btn btn-outline-secondary btn-lg">
                <i class="fas fa-arrow-left me-2"></i>Cancel
              </a>
              <button type="submit" class="btn btn-primary btn-lg">
                <i class="fas fa-save me-2"></i>Save Changes
              </button>
            </div>

          </form>
        </div>
      </div>

    </div>
  </div>
</div>
