<% layout('layout/boilerplate.ejs') %>

<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">
      <!-- Profile Completion Header -->
      <div class="complete-profile-header text-center mb-5">
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 25px; padding: 50px 30px; color: white; box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3); position: relative; overflow: hidden;">
          <div style="position: absolute; top: -20px; right: -20px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
          <div style="position: absolute; bottom: -30px; left: -30px; width: 150px; height: 150px; background: rgba(255,255,255,0.05); border-radius: 50%;"></div>
          <div style="font-size: 4rem; margin-bottom: 20px; opacity: 0.9;">
            <i class="fas fa-user-edit"></i>
          </div>
          <h1 style="font-weight: 700; font-size: 2.5rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); margin-bottom: 10px;">
            Complete Your Profile
          </h1>
          <p style="opacity: 0.9; margin-bottom: 0; font-size: 1.1rem;">
            Tell us a bit more about yourself to personalize your EduVision AI experience
          </p>
        </div>
      </div>

      <!-- Profile Completion Form -->
      <div class="complete-profile-card" style="background: linear-gradient(145deg, #ffffff 0%, #f8f9ff 100%); border-radius: 20px; box-shadow: 0 10px 30px rgba(102, 126, 234, 0.15); overflow: hidden; border: 1px solid rgba(102, 126, 234, 0.1);">
        <div class="complete-profile-card-body" style="padding: 40px;">
          <form action="/complete-profile" method="POST" class="needs-validation" novalidate>

            <!-- Bio Section -->
            <div class="mb-4">
              <label for="bio" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1.1rem; margin-bottom: 12px;">
                <i class="fas fa-info-circle me-2" style="color: #667eea;"></i>About You
              </label>
              <div style="position: relative;">
                <textarea class="form-control form-control-lg" id="bio" name="bio" rows="4"
                         style="border-radius: 15px; border: 2px solid #e9ecef; padding: 16px 20px; font-size: 1rem; transition: all 0.3s ease; resize: vertical; background: rgba(102, 126, 234, 0.02);"
                         placeholder="Share a bit about yourself, your interests, or your goals..."></textarea>
                <small style="color: #6c757d; font-size: 0.9rem; margin-top: 8px; display: block;">
                  <i class="fas fa-lightbulb me-1"></i>This helps us personalize your experience (optional)
                </small>
              </div>
            </div>

            <!-- Role Selection -->
            <div class="mb-4">
              <label for="role" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1.1rem; margin-bottom: 12px;">
                <i class="fas fa-graduation-cap me-2" style="color: #667eea;"></i>I am a
              </label>
              <select class="form-select form-select-lg" id="role" name="role" required
                      style="border-radius: 15px; border: 2px solid #e9ecef; padding: 14px 20px; font-size: 1rem; transition: all 0.3s ease; background: rgba(102, 126, 234, 0.02);">
                <option value="">Select your role</option>
                <option value="Teacher">üë®‚Äçüè´ Teacher - I create and share educational content</option>
                <option value="Student">üéì Student - I learn and study materials</option>
              </select>
              <div class="invalid-feedback" style="margin-top: 8px;">
                Please select your role to continue.
              </div>
            </div>

            <!-- Student Type (Conditional) -->
            <div class="mb-4" id="studentTypeDiv" style="display: none;">
              <label for="studentType" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1.1rem; margin-bottom: 12px;">
                <i class="fas fa-school me-2" style="color: #667eea;"></i>Education Level
              </label>
              <select class="form-select form-select-lg" id="studentType" name="studentType"
                      style="border-radius: 15px; border: 2px solid #e9ecef; padding: 14px 20px; font-size: 1rem; transition: all 0.3s ease; background: rgba(102, 126, 234, 0.02);">
                <option value="">Select your education level</option>
                <option value="High School">üè´ High School - Grades 9-12</option>
                <option value="University/College">üéì University/College - Higher education</option>
              </select>
            </div>

            <!-- Grade (Conditional) -->
            <div class="mb-4" id="gradeDiv" style="display: none;">
              <label for="grade" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1.1rem; margin-bottom: 12px;">
                <i class="fas fa-graduation-cap me-2" style="color: #667eea;"></i>Grade Level
              </label>
              <select class="form-select form-select-lg" id="grade" name="grade"
                      style="border-radius: 15px; border: 2px solid #e9ecef; padding: 14px 20px; font-size: 1rem; transition: all 0.3s ease; background: rgba(102, 126, 234, 0.02);">
                <option value="">Select your grade</option>
                <option value="9">9th Grade - Freshman</option>
                <option value="10">10th Grade - Sophomore</option>
                <option value="11">11th Grade - Junior</option>
                <option value="12">12th Grade - Senior</option>
              </select>
            </div>

            <!-- Timezone -->
            <div class="mb-4">
              <label for="timezone" class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1.1rem; margin-bottom: 12px;">
                <i class="fas fa-globe me-2" style="color: #667eea;"></i>Timezone
              </label>
              <input type="text" class="form-control form-control-lg" id="timezone" name="timezone" list="timezoneList"
                     style="border-radius: 15px; border: 2px solid #e9ecef; padding: 14px 20px; font-size: 1rem; transition: all 0.3s ease; background: rgba(102, 126, 234, 0.02);"
                     placeholder="Start typing to search timezones...">
              <datalist id="timezoneList">
                <option value="UTC-12:00 - Baker Island Time">
                <option value="UTC-11:00 - Niue Time">
                <option value="UTC-10:00 - Hawaii-Aleutian Standard Time">
                <option value="UTC-09:00 - Alaska Standard Time">
                <option value="UTC-08:00 - Pacific Standard Time">
                <option value="UTC-07:00 - Mountain Standard Time">
                <option value="UTC-06:00 - Central Standard Time">
                <option value="UTC-05:00 - Eastern Standard Time">
                <option value="UTC-04:00 - Atlantic Standard Time">
                <option value="UTC-03:00 - Argentina Time">
                <option value="UTC-02:00 - South Georgia Time">
                <option value="UTC-01:00 - Azores Time">
                <option value="UTC+00:00 - Greenwich Mean Time">
                <option value="UTC+01:00 - Central European Time">
                <option value="UTC+02:00 - Eastern European Time">
                <option value="UTC+03:00 - Moscow Time">
                <option value="UTC+04:00 - Gulf Standard Time">
                <option value="UTC+05:00 - Pakistan Standard Time">
                <option value="UTC+06:00 - Bangladesh Standard Time">
                <option value="UTC+07:00 - Indochina Time">
                <option value="UTC+08:00 - China Standard Time">
                <option value="UTC+09:00 - Japan Standard Time">
                <option value="UTC+10:00 - Australian Eastern Standard Time">
                <option value="UTC+11:00 - Solomon Islands Time">
                <option value="UTC+12:00 - Fiji Time">
              </datalist>
              <small style="color: #6c757d; font-size: 0.9rem; margin-top: 8px; display: block;">
                <i class="fas fa-clock me-1"></i>Start typing to search and select your local timezone (optional)
              </small>
            </div>

            <!-- Study Preferences -->
            <div class="mb-4">
              <label class="form-label" style="font-weight: 600; color: #2c3e50; font-size: 1.1rem; margin-bottom: 12px;">
                <i class="fas fa-book me-2" style="color: #667eea;"></i>Study Preferences
              </label>

              <!-- Subjects -->
              <div class="mb-3">
                <label style="font-weight: 500; color: #2c3e50; font-size: 1rem; margin-bottom: 8px;">
                  <i class="fas fa-list me-2" style="color: #667eea;"></i>Favorite Subjects
                </label>
                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                  <% const subjects = ['Mathematics', 'Science', 'English', 'History', 'Geography', 'Art', 'Music', 'Physical Education', 'Computer Science', 'Languages']; %>
                  <% subjects.forEach(subject => { %>
                    <div class="form-check" style="flex: 1 1 200px;">
                      <input class="form-check-input" type="checkbox" name="studyPreferences[subject]" value="<%= subject %>" id="complete-subject-<%= subject.replace(/\s+/g, '-').toLowerCase() %>"
                             style="transform: scale(1.2); margin-right: 8px;">
                      <label class="form-check-label" for="complete-subject-<%= subject.replace(/\s+/g, '-').toLowerCase() %>" style="font-size: 0.95rem; color: #495057;">
                        <%= subject %>
                      </label>
                    </div>
                  <% }); %>
                </div>
                <small style="color: #6c757d; font-size: 0.9rem; margin-top: 8px; display: block;">
                  <i class="fas fa-info-circle me-1"></i>Select subjects you're interested in studying (optional)
                </small>
              </div>

              <!-- Availability -->
              <div class="mb-3">
                <label style="font-weight: 500; color: #2c3e50; font-size: 1rem; margin-bottom: 8px;">
                  <i class="fas fa-calendar-alt me-2" style="color: #667eea;"></i>Study Availability
                </label>
                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                  <% const availabilities = ['Weekdays Morning', 'Weekdays Afternoon', 'Weekdays Evening', 'Weekends Morning', 'Weekends Afternoon', 'Weekends Evening', 'Flexible']; %>
                  <% availabilities.forEach(availability => { %>
                    <div class="form-check" style="flex: 1 1 200px;">
                      <input class="form-check-input" type="checkbox" name="studyPreferences[availability]" value="<%= availability %>" id="complete-availability-<%= availability.replace(/\s+/g, '-').toLowerCase() %>"
                             style="transform: scale(1.2); margin-right: 8px;">
                      <label class="form-check-label" for="complete-availability-<%= availability.replace(/\s+/g, '-').toLowerCase() %>" style="font-size: 0.95rem; color: #495057;">
                        <%= availability %>
                      </label>
                    </div>
                  <% }); %>
                </div>
                <small style="color: #6c757d; font-size: 0.9rem; margin-top: 8px; display: block;">
                  <i class="fas fa-clock me-1"></i>Select your preferred study times (optional)
                </small>
              </div>

              <!-- Goals -->
              <div class="mb-3">
                <label for="studyGoals" style="font-weight: 500; color: #2c3e50; font-size: 1rem; margin-bottom: 8px;">
                  <i class="fas fa-bullseye me-2" style="color: #667eea;"></i>Study Goals
                </label>
                <textarea class="form-control form-control-lg" id="studyGoals" name="studyPreferences[goals]" rows="3"
                         style="border-radius: 15px; border: 2px solid #e9ecef; padding: 14px 20px; font-size: 1rem; transition: all 0.3s ease; background: rgba(102, 126, 234, 0.02); resize: vertical;"
                         placeholder="Describe your study goals, e.g., improve grades, prepare for exams, learn new skills..."></textarea>
                <small style="color: #6c757d; font-size: 0.9rem; margin-top: 8px; display: block;">
                  <i class="fas fa-lightbulb me-1"></i>Share your learning objectives (optional)
                </small>
              </div>
            </div>

            <!-- Complete Profile Button -->
            <div class="d-grid mt-5">
              <button type="submit" class="btn btn-primary btn-lg" style="border-radius: 25px; font-weight: 700; font-size: 1.1rem; padding: 16px; box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3); transition: all 0.3s ease; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
                <i class="fas fa-check-circle me-2"></i>Complete My Profile
              </button>
            </div>
          </form>

          <!-- Progress Indicator -->
          <div class="text-center mt-4">
            <small style="color: #6c757d;">
              <i class="fas fa-info-circle me-1"></i>Step 1 of 1 - You're almost done!
            </small>
          </div>
        </div>
      </div>

      <!-- Skip Option -->
      <div class="text-center mt-4">
        <a href="/" class="text-decoration-none" style="color: #6c757d; font-size: 0.9rem;">
          <i class="fas fa-arrow-right me-1"></i>Skip for now and complete later
        </a>
      </div>
    </div>
  </div>
</div>

<script>
// Role-based field visibility
document.getElementById('role').addEventListener('change', function() {
  const studentTypeDiv = document.getElementById('studentTypeDiv');
  const gradeDiv = document.getElementById('gradeDiv');
  const studentType = document.getElementById('studentType');

  if (this.value === 'Student') {
    studentTypeDiv.style.display = 'block';
    studentType.required = true;
  } else {
    studentTypeDiv.style.display = 'none';
    gradeDiv.style.display = 'none';
    studentType.required = false;
    document.getElementById('grade').required = false;
  }
});

document.getElementById('studentType').addEventListener('change', function() {
  const gradeDiv = document.getElementById('gradeDiv');
  const grade = document.getElementById('grade');

  if (this.value === 'High School') {
    gradeDiv.style.display = 'block';
    grade.required = true;
  } else {
    gradeDiv.style.display = 'none';
    grade.required = false;
  }
});

// Form validation and enhancement
document.addEventListener('DOMContentLoaded', function() {
  const form = document.querySelector('.needs-validation');

  form.addEventListener('submit', function(event) {
    if (!form.checkValidity()) {
      event.preventDefault();
      event.stopPropagation();
    }
    form.classList.add('was-validated');
  });

  // Enhanced focus effects
  const inputs = document.querySelectorAll('input, select, textarea');
  inputs.forEach(input => {
    input.addEventListener('focus', function() {
      this.style.borderColor = '#667eea';
      this.style.boxShadow = '0 0 0 0.2rem rgba(102, 126, 234, 0.25)';
      this.style.background = 'rgba(102, 126, 234, 0.05)';
    });

    input.addEventListener('blur', function() {
      this.style.borderColor = '#e9ecef';
      this.style.boxShadow = 'none';
      this.style.background = 'rgba(102, 126, 234, 0.02)';
    });
  });
});
</script>

<style>
.complete-profile-card input:focus, .complete-profile-card select:focus, .complete-profile-card textarea:focus {
  border-color: #667eea !important;
  box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25) !important;
  background: rgba(102, 126, 234, 0.05) !important;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4) !important;
}

.form-select option {
  padding: 8px;
}
</style>
